"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var q=require("type-flag"),N=require("tty"),A=require("terminal-columns");function y(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var P=y(q),B=y(N),S=y(A);const D=t=>t.replace(/[-_ ](\w)/g,(e,r)=>r.toUpperCase()),I=t=>t.replace(/\B([A-Z])/g,"-$1").toLowerCase(),L={"> 80":[{width:"content-width",paddingLeft:2,paddingRight:8},{width:"auto"}],"> 40":[{width:"auto",paddingLeft:2,paddingRight:8,preprocess:t=>t.trim()},{width:"100%",paddingLeft:2,paddingBottom:1}],"> 0":{stdoutColumns:1e3,columns:[{width:"content-width",paddingLeft:2,paddingRight:8},{width:"content-width"}]}};function R(t){let e=!1;const n=Object.keys(t).sort((a,i)=>a.localeCompare(i)).map(a=>{const i=t[a],s="alias"in i;return s&&(e=!0),{name:a,flag:i,flagFormatted:`--${I(a)}`,aliasesEnabled:e,aliasFormatted:s?`-${i.alias}`:void 0}}).map(a=>(a.aliasesEnabled=e,[{type:"flagName",data:a},{type:"flagDescription",data:a}]));return{type:"table",data:{tableData:n,tableBreakpoints:L}}}const x=t=>{var e;return!t||((e=t.version)!=null?e:t.help?t.help.version:void 0)},_=t=>{var e;const r="parent"in t&&((e=t.parent)==null?void 0:e.name);return(r?`${r} `:"")+t.name};function T(t){var e;const r=[];t.name&&r.push(_(t));const n=(e=x(t))!=null?e:"parent"in t&&x(t.parent);if(n&&r.push(`v${n}`),r.length!==0)return{id:"name",type:"text",data:`${r.join(" ")}
`}}function k(t){const{help:e}=t;if(!(!e||!e.description))return{id:"description",type:"text",data:`${e.description}
`}}function H(t){var e;const r=t.help||{};if("usage"in r)return r.usage?{id:"usage",type:"section",data:{title:"Usage:",body:Array.isArray(r.usage)?r.usage.join(`
`):r.usage}}:void 0;if(t.name){const n=[],a=[_(t)];if(t.flags&&Object.keys(t.flags).length>0&&a.push("[flags...]"),t.parameters&&t.parameters.length>0){const{parameters:i}=t,s=i.indexOf("--"),o=s>-1&&i.slice(s+1).some(l=>l.startsWith("<"));a.push(i.map(l=>l!=="--"?l:o?"--":"[--]").join(" "))}if(a.length>1&&n.push(a.join(" ")),"commands"in t&&((e=t.commands)==null?void 0:e.length)&&n.push(`${t.name} <command>`),n.length>0)return{id:"usage",type:"section",data:{title:"Usage:",body:n.join(`
`)}}}}function M(t){var e;if(!("commands"in t)||!((e=t.commands)==null?void 0:e.length))return;const r=t.commands.map(a=>[a.options.name,a.options.help?a.options.help.description:""]);return{id:"commands",type:"section",data:{title:"Commands:",body:{type:"table",data:{tableData:r,tableOptions:[{width:"content-width",paddingLeft:2,paddingRight:8}]}},indentBody:0}}}function U(t){if(!(!t.flags||Object.keys(t.flags).length===0))return{id:"flags",type:"section",data:{title:"Flags:",body:R(t.flags),indentBody:0}}}function J(t){const{help:e}=t;if(!e||!e.examples||e.examples.length===0)return;let{examples:r}=e;if(Array.isArray(r)&&(r=r.join(`
`)),r)return{id:"examples",type:"section",data:{title:"Examples:",body:r}}}function V(t){if(!("alias"in t)||!t.alias)return;const{alias:e}=t,r=Array.isArray(e)?e.join(", "):e;return{id:"aliases",type:"section",data:{title:"Aliases:",body:r}}}const F=t=>[T,k,H,M,U,J,V].map(e=>e(t)).filter(e=>Boolean(e)),W=B.default.WriteStream.prototype.hasColors();class Z{text(e){return e}bold(e){return W?`\x1B[1m${e}\x1B[22m`:e.toLocaleUpperCase()}indentText({text:e,spaces:r}){return e.replace(/^/gm," ".repeat(r))}heading(e){return this.bold(e)}section({title:e,body:r,indentBody:n=2}){return`${(e?`${this.heading(e)}
`:"")+(r?this.indentText({text:this.render(r),spaces:n}):"")}
`}table({tableData:e,tableOptions:r,tableBreakpoints:n}){return S.default(e.map(a=>a.map(i=>this.render(i))),n?A.breakpoints(n):r)}flagParameter(e){return e===Boolean?"":e===String?"<string>":e===Number?"<number>":Array.isArray(e)?this.flagParameter(e[0]):"<value>"}flagOperator(){return" "}flagName({flag:e,flagFormatted:r,aliasesEnabled:n,aliasFormatted:a}){let i="";if(a?i+=`${a}, `:n&&(i+="    "),i+=r,"placeholder"in e&&typeof e.placeholder=="string")i+=`${this.flagOperator()}${e.placeholder}`;else{const s=this.flagParameter("type"in e?e.type:e);s&&(i+=`${this.flagOperator()}${s}`)}return i}flagDefault(e){return JSON.stringify(e)}flagDescription({flag:e}){var r;let n="description"in e&&(r=e.description)!=null?r:"";if("default"in e){let{default:a}=e;typeof a=="function"&&(a=a()),a&&(n+=` (default: ${this.flagDefault(a)})`)}return n}render(e){if(typeof e=="string")return e;if(Array.isArray(e))return e.map(r=>this.render(r)).join(`
`);if("type"in e&&this[e.type]){const r=this[e.type];if(typeof r=="function")return r.call(this,e.data)}throw new Error(`Invalid node type: ${JSON.stringify(e)}`)}}const w=/^[\w.-]+$/,{stringify:d}=JSON,z=/[|\\{}()[\]^$+*?.]/;function v(t){const e=[];let r,n;for(const a of t){if(n)throw new Error(`Invalid parameter: Spread parameter ${d(n)} must be last`);const i=a[0],s=a[a.length-1];let o;if(i==="<"&&s===">"&&(o=!0,r))throw new Error(`Invalid parameter: Required parameter ${d(a)} cannot come after optional parameter ${d(r)}`);if(i==="["&&s==="]"&&(o=!1,r=a),o===void 0)throw new Error(`Invalid parameter: ${d(a)}. Must be wrapped in <> (required parameter) or [] (optional parameter)`);let l=a.slice(1,-1);const f=l.slice(-3)==="...";f&&(n=a,l=l.slice(0,-3));const m=l.match(z);if(m)throw new Error(`Invalid parameter: ${d(a)}. Invalid character found ${d(m[0])}`);e.push({name:l,required:o,spread:f})}return e}function b(t,e,r,n){for(let a=0;a<e.length;a+=1){const{name:i,required:s,spread:o}=e[a],l=D(i);if(l in t)throw new Error(`Invalid parameter: ${d(i)} is used more than once.`);const f=o?r.slice(a):r[a];if(o&&(a=e.length),s&&(!f||o&&f.length===0))return console.error(`Error: Missing required parameter ${d(i)}
`),n(),process.exit(1);t[l]=f}}function G(t){return t===void 0||t!==!1}function O(t,e,r,n){const a={...e.flags},i=e.version;i&&(a.version={type:Boolean,description:"Show version"});const{help:s}=e,o=G(s);o&&!("help"in a)&&(a.help={type:Boolean,alias:"h",description:"Show help"});const l=P.default(a,n),f=()=>{console.log(e.version)};if(i&&l.flags.version===!0)return f(),process.exit(0);const m=new Z,j=o&&(s==null?void 0:s.render)?s.render:c=>m.render(c),p=c=>{const u=F({...e,...c?{help:c}:{},flags:a});console.log(j(u,m))};if(o&&l.flags.help===!0)return p(),process.exit(0);if(e.parameters){let{parameters:c}=e,u=l._;const g=c.indexOf("--"),C=c.slice(g+1),h=Object.create(null);if(g>-1&&C.length>0){c=c.slice(0,g);const E=l._["--"];u=u.slice(0,-E.length||void 0),b(h,v(c),u,p),b(h,v(C),E,p)}else b(h,v(c),u,p);Object.assign(l._,h)}const $={...l,showVersion:f,showHelp:p};return typeof r=="function"&&r($),{command:t,...$}}function K(t,e){const r=new Map;for(const n of e){const a=[n.options.name],{alias:i}=n.options;i&&(Array.isArray(i)?a.push(...i):a.push(i));for(const s of a){if(r.has(s))throw new Error(`Duplicate command name found: ${d(s)}`);r.set(s,n)}}return r.get(t)}function Q(t,e,r=process.argv.slice(2)){if(!t)throw new Error("Options is required");if("name"in t&&(!t.name||!w.test(t.name)))throw new Error(`Invalid script name: ${d(t.name)}`);const n=r[0];if(t.commands&&w.test(n)){const a=K(n,t.commands);if(a)return O(a.options.name,{...a.options,parent:t},a.callback,r.slice(1))}return O(void 0,t,e,r)}function X(t,e){if(!t)throw new Error("Command options are required");const{name:r}=t;if(t.name===void 0)throw new Error("Command name is required");if(!w.test(r))throw new Error(`Invalid command name ${JSON.stringify(r)}. Command names must be one word.`);return{options:t,callback:e}}exports.cli=Q,exports.command=X;
