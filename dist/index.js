"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var B=require("type-flag"),I=require("tty"),C=require("terminal-columns");function v(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var D=v(B),L=v(I),R=v(C);const T=r=>r.replace(/[-_ ](\w)/g,(e,t)=>t.toUpperCase()),F=r=>r.replace(/\B([A-Z])/g,"-$1").toLowerCase(),H={"> 80":[{width:"content-width",paddingLeft:2,paddingRight:8},{width:"auto"}],"> 40":[{width:"auto",paddingLeft:2,paddingRight:8,preprocess:r=>r.trim()},{width:"100%",paddingLeft:2,paddingBottom:1}],"> 0":{stdoutColumns:1e3,columns:[{width:"content-width",paddingLeft:2,paddingRight:8},{width:"content-width"}]}};function M(r){let e=!1;const n=Object.keys(r).sort((a,i)=>a.localeCompare(i)).map(a=>{const i=r[a],s="alias"in i;return s&&(e=!0),{name:a,flag:i,flagFormatted:`--${F(a)}`,aliasesEnabled:e,aliasFormatted:s?`-${i.alias}`:void 0}}).map(a=>(a.aliasesEnabled=e,[{type:"flagName",data:a},{type:"flagDescription",data:a}]));return{type:"table",data:{tableData:n,tableBreakpoints:H}}}const A=r=>{var e;return!r||((e=r.version)!=null?e:r.help?r.help.version:void 0)},x=r=>{var e;const t="parent"in r&&((e=r.parent)==null?void 0:e.name);return(t?`${t} `:"")+r.name};function U(r){var e;const t=[];r.name&&t.push(x(r));const n=(e=A(r))!=null?e:"parent"in r&&A(r.parent);if(n&&t.push(`v${n}`),t.length!==0)return{id:"name",type:"text",data:`${t.join(" ")}
`}}function V(r){const{help:e}=r;if(!(!e||!e.description))return{id:"description",type:"text",data:`${e.description}
`}}function J(r){var e;const t=r.help||{};if("usage"in t)return t.usage?{id:"usage",type:"section",data:{title:"Usage:",body:Array.isArray(t.usage)?t.usage.join(`
`):t.usage}}:void 0;if(r.name){const n=[],a=[x(r)];if(r.flags&&Object.keys(r.flags).length>0&&a.push("[flags...]"),r.parameters&&r.parameters.length>0){const{parameters:i}=r,s=i.indexOf("--"),l=s>-1&&i.slice(s+1).some(o=>o.startsWith("<"));a.push(i.map(o=>o!=="--"?o:l?"--":"[--]").join(" "))}if(a.length>1&&n.push(a.join(" ")),"commands"in r&&((e=r.commands)==null?void 0:e.length)&&n.push(`${r.name} <command>`),n.length>0)return{id:"usage",type:"section",data:{title:"Usage:",body:n.join(`
`)}}}}function k(r){var e;if(!("commands"in r)||!((e=r.commands)!=null&&e.length))return;const t=r.commands.map(a=>[a.options.name,a.options.help?a.options.help.description:""]);return{id:"commands",type:"section",data:{title:"Commands:",body:{type:"table",data:{tableData:t,tableOptions:[{width:"content-width",paddingLeft:2,paddingRight:8}]}},indentBody:0}}}function W(r){if(!(!r.flags||Object.keys(r.flags).length===0))return{id:"flags",type:"section",data:{title:"Flags:",body:M(r.flags),indentBody:0}}}function Z(r){const{help:e}=r;if(!e||!e.examples||e.examples.length===0)return;let{examples:t}=e;if(Array.isArray(t)&&(t=t.join(`
`)),t)return{id:"examples",type:"section",data:{title:"Examples:",body:t}}}function z(r){if(!("alias"in r)||!r.alias)return;const{alias:e}=r,t=Array.isArray(e)?e.join(", "):e;return{id:"aliases",type:"section",data:{title:"Aliases:",body:t}}}const G=r=>[U,V,J,k,W,Z,z].map(e=>e(r)).filter(e=>Boolean(e)),K=L.default.WriteStream.prototype.hasColors();class Q{text(e){return e}bold(e){return K?`\x1B[1m${e}\x1B[22m`:e.toLocaleUpperCase()}indentText({text:e,spaces:t}){return e.replace(/^/gm," ".repeat(t))}heading(e){return this.bold(e)}section({title:e,body:t,indentBody:n=2}){return`${(e?`${this.heading(e)}
`:"")+(t?this.indentText({text:this.render(t),spaces:n}):"")}
`}table({tableData:e,tableOptions:t,tableBreakpoints:n}){return R.default(e.map(a=>a.map(i=>this.render(i))),n?C.breakpoints(n):t)}flagParameter(e){return e===Boolean?"":e===String?"<string>":e===Number?"<number>":Array.isArray(e)?this.flagParameter(e[0]):"<value>"}flagOperator(e){return" "}flagName(e){const{flag:t,flagFormatted:n,aliasesEnabled:a,aliasFormatted:i}=e;let s="";if(i?s+=`${i}, `:a&&(s+="    "),s+=n,"placeholder"in t&&typeof t.placeholder=="string")s+=`${this.flagOperator(e)}${t.placeholder}`;else{const l=this.flagParameter("type"in t?t.type:t);l&&(s+=`${this.flagOperator(e)}${l}`)}return s}flagDefault(e){return JSON.stringify(e)}flagDescription({flag:e}){var t;let n="description"in e&&(t=e.description)!=null?t:"";if("default"in e){let{default:a}=e;typeof a=="function"&&(a=a()),a&&(n+=` (default: ${this.flagDefault(a)})`)}return n}render(e){if(typeof e=="string")return e;if(Array.isArray(e))return e.map(t=>this.render(t)).join(`
`);if("type"in e&&this[e.type]){const t=this[e.type];if(typeof t=="function")return t.call(this,e.data)}throw new Error(`Invalid node type: ${JSON.stringify(e)}`)}}const w=/^[\w.-]+$/;var X=Object.defineProperty,Y=Object.defineProperties,ee=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,N=(r,e,t)=>e in r?X(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,m=(r,e)=>{for(var t in e||(e={}))re.call(e,t)&&N(r,t,e[t]);if(j)for(var t of j(e))te.call(e,t)&&N(r,t,e[t]);return r},b=(r,e)=>Y(r,ee(e));const{stringify:d}=JSON,ae=/[|\\{}()[\]^$+*?.]/;function _(r){const e=[];let t,n;for(const a of r){if(n)throw new Error(`Invalid parameter: Spread parameter ${d(n)} must be last`);const i=a[0],s=a[a.length-1];let l;if(i==="<"&&s===">"&&(l=!0,t))throw new Error(`Invalid parameter: Required parameter ${d(a)} cannot come after optional parameter ${d(t)}`);if(i==="["&&s==="]"&&(l=!1,t=a),l===void 0)throw new Error(`Invalid parameter: ${d(a)}. Must be wrapped in <> (required parameter) or [] (optional parameter)`);let o=a.slice(1,-1);const f=o.slice(-3)==="...";f&&(n=a,o=o.slice(0,-3));const p=o.match(ae);if(p)throw new Error(`Invalid parameter: ${d(a)}. Invalid character found ${d(p[0])}`);e.push({name:o,required:l,spread:f})}return e}function $(r,e,t,n){for(let a=0;a<e.length;a+=1){const{name:i,required:s,spread:l}=e[a],o=T(i);if(o in r)throw new Error(`Invalid parameter: ${d(i)} is used more than once.`);const f=l?t.slice(a):t[a];if(l&&(a=e.length),s&&(!f||l&&f.length===0))return console.error(`Error: Missing required parameter ${d(i)}
`),n(),process.exit(1);r[o]=f}}function ne(r){return r===void 0||r!==!1}function S(r,e,t,n){const a=m({},e.flags),i=e.version;i&&(a.version={type:Boolean,description:"Show version"});const{help:s}=e,l=ne(s);l&&!("help"in a)&&(a.help={type:Boolean,alias:"h",description:"Show help"});const o=D.default(a,n),f=()=>{console.log(e.version)};if(i&&o.flags.version===!0)return f(),process.exit(0);const p=new Q,q=l&&(s==null?void 0:s.render)?s.render:c=>p.render(c),h=c=>{const u=G(b(m(m({},e),c?{help:c}:{}),{flags:a}));console.log(q(u,p))};if(l&&o.flags.help===!0)return h(),process.exit(0);if(e.parameters){let{parameters:c}=e,u=o._;const y=c.indexOf("--"),E=c.slice(y+1),g=Object.create(null);if(y>-1&&E.length>0){c=c.slice(0,y);const P=o._["--"];u=u.slice(0,-P.length||void 0),$(g,_(c),u,h),$(g,_(E),P,h)}else $(g,_(c),u,h);Object.assign(o._,g)}const O=b(m({},o),{showVersion:f,showHelp:h});return typeof t=="function"&&t(O),m({command:r},O)}function ie(r,e){const t=new Map;for(const n of e){const a=[n.options.name],{alias:i}=n.options;i&&(Array.isArray(i)?a.push(...i):a.push(i));for(const s of a){if(t.has(s))throw new Error(`Duplicate command name found: ${d(s)}`);t.set(s,n)}}return t.get(r)}function se(r,e,t=process.argv.slice(2)){if(!r)throw new Error("Options is required");if("name"in r&&(!r.name||!w.test(r.name)))throw new Error(`Invalid script name: ${d(r.name)}`);const n=t[0];if(r.commands&&w.test(n)){const a=ie(n,r.commands);if(a)return S(a.options.name,b(m({},a.options),{parent:r}),a.callback,t.slice(1))}return S(void 0,r,e,t)}function oe(r,e){if(!r)throw new Error("Command options are required");const{name:t}=r;if(r.name===void 0)throw new Error("Command name is required");if(!w.test(t))throw new Error(`Invalid command name ${JSON.stringify(t)}. Command names must be one word.`);return{options:r,callback:e}}exports.cli=se,exports.command=oe;
